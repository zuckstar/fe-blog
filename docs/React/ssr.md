# 服务端渲染 SSR

## 1. 是什么

指由服务侧完成页面的 HTML 结构拼接的页面处理技术，发送到浏览器，然后为其绑定状态与事件，成为完全可交互页面的过程。

其解决的问题主要有两个：

- SEO，由于搜索引擎爬虫抓取工具可以直接查看完全渲染的页面

- 加速首屏加载，解决首屏白屏问题

## 2. 如何做

在 react 中，实现 SSR 主要有两种形式：

- 手动搭建一个 SSR 框架

- 使用成熟的 SSR 框架，如 Next.JS

这里主要以手动搭建一个 SSR 框架进行实现，主要步骤如下：

- 识别和解析 JSX：使用 webpack 对项目进行打包转换，修改 webpack.server.js，loader 使用 babel-loader

- React 组件转成 HTML：使用 react-dom 提供的服务端渲染的 renderToString 方法，负则把 React 组件解析成 HTML

- 水合：事件处理方法需要组件代码在浏览器中再执行一遍

  - 重构通俗讲就是一套 React 代码在服务器上运行一遍，到达浏览器又运行一遍：

    - 服务端渲染完成页面结构

    - 浏览器端渲染完成事件绑定

- 客户端加载 JavaScript 文件：JS 代码执行并接管页面的操作

- 路由渲染服务端不一致

### 3. 原理

整体 react 服务端渲染原理并不复杂，具体如下：

- node server 接收客户端请求，得到当前的请求 url 路径，然后在已有的路由表内查找到对应的组件，拿到需要请求的数据，将数据作为 props、context 或者 store 形式传入组件

- 然后基于 react 内置的服务端渲染方法 renderToString()把组件渲染为 html 字符串在把最终的 html 进行输出前需要将数据注入到浏览器端

- 浏览器开始进行渲染和节点对比，然后执行完成组件内事件绑定和一些交互，浏览器重用了服务端输出的 html 节点，整个流程结束

## 面试题

### 说说 React 服务端渲染怎么做？原理是什么？
